---
title: 'How to set the TX Power on ESP32 OpenThread Devices'
description: "Tutorial on how to set and get the TX power on ESP32 OpenThread devices when using ESP-IDF."
date: 2024-06-5
draft: false
---

import Callout from "@/components/Callout.astro";

---

When developing on ESP32 devices running OpenThread, a key feature that I needed was the ability to set the transmission (TX) power of these devices.

Guidance on how to set and query the TX power of ESP32 Thread devices can be found in the documentations provided by OpenThread and Espressif. I wanted to write a quick guide that gathered the information provided by the documentations in a single place, along with providing references to a couple of examples.

## Setting TX Power in Code

Most settings on ESP32 devices would typically be set using `Kconfig` variables and configured using `idf.py menuconfig`. However, this is no such `Kconfig` configuration for the TX power.

According to [ESP-Techpedia](https://docs.espressif.com/projects/esp-techpedia/en/latest/esp-friends/advanced-development/performance/modify-tx-power.html#thread-tx-power), the TX power must be set *programmatically*. One way to do so is using the [`otPlatRadioSetTransmitPower()`]((https://openthread.io/reference/group/radio-config#otplatradiosettransmitpower)) class method provided by OpenThread, which under the hood is a wrapper function for the `esp_ieee802154_set_txpower()` function [implemented in ESP-IDF](https://github.com/espressif/esp-idf/blob/master/components/openthread/src/port/esp_openthread_radio.c#L441). This makes sense since the [ESP-Techpedia](https://docs.espressif.com/projects/esp-techpedia/en/latest/esp-friends/advanced-development/performance/modify-tx-power.html#thread-tx-power) states that:

> If developing directly based on the 802.15.4 MAC driver, it is recommended to adjust the transmission power of Thread through `esp_ieee802154_set_txpower`.

Similarly, if you want to get the TX power value that is currently set by the device, you use the [`otPlatRadioGetTransmitPower()`](https://openthread.io/reference/group/radio-config#group__radio-config_1gadba7cca4c1176c4efeb789b1f90a5057) class method provided by OpenThread. ESP-IDF [implements the method as a wrapper](https://github.com/espressif/esp-idf/blob/master/components/openthread/src/port/esp_openthread_radio.c#L434) for their `esp_ieee802154_get_txpower()` function.

## Examples

The source code for the [OpenThread CLI](https://github.com/openthread/openthread/blob/main/src/cli/cli.cpp) contains a great example on how to set and query the TX power in the [implementation](https://github.com/openthread/openthread/blob/main/src/cli/cli.cpp#L6738) for the `txpower` CLI command.

In addition, [my ESP32 programming projects](https://github.com/UCSC-ThreadAscon) contain examples on how to use the OpenThread TX power class methods. One such example is in my project where I implement an ESP32-H2 as a Sleepy End Device (SED). In this project, I [defined wrapper funtions](https://github.com/UCSC-ThreadAscon/energy-usage-sed-simple/blob/main/main/txpower.c) on top of the `otPlatRadio` TX power methods, and I use those functions to [set and query the TX power](https://github.com/UCSC-ThreadAscon/energy-usage-sed-simple/blob/main/main/main.c#L253) of the SED.